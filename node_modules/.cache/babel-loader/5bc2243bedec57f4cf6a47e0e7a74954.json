{"ast":null,"code":"import _classCallCheck from \"C:\\\\viz\\\\visualyticsFrontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\viz\\\\visualyticsFrontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\viz\\\\visualyticsFrontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\viz\\\\visualyticsFrontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\viz\\\\visualyticsFrontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\viz\\\\visualyticsFrontend\\\\src\\\\views\\\\Tables.js\";\nimport React from \"react\";\nimport { Container, Row, Col, Card, CardHeader, CardBody } from \"shards-react\"; // import ScriptTag from 'react-script-tag';\n\nimport * as d3 from \"d3\";\n\nvar Tables = /*#__PURE__*/function (_React$Component) {\n  _inherits(Tables, _React$Component);\n\n  function Tables() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Tables);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Tables)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.create_visualization = function () {\n      var processed_data_arr = [];\n      var keys = Object.keys(processed_data);\n\n      for (var i = 0; i < keys.length; i++) {\n        var dat = processed_data[keys[i]];\n        dat[\"key\"] = keys[i];\n        processed_data_arr.push(dat);\n      }\n\n      var time = 1;\n      var processed_data = {};\n      d3.csv('http://localhost/html/main/journey.csv', function (data) {\n        if (processed_data[data[\"TUCASEID\"]] === undefined) {\n          processed_data[data[\"TUCASEID\"]] = {};\n          processed_data[data[\"TUCASEID\"]][\"activity\"] = [{\n            \"start\": 20,\n            \"stop\": 20,\n            \"activity_code\": 0\n          }];\n          processed_data[data[\"TUCASEID\"]][\"current_activity\"] = 1;\n        }\n\n        var activity_id = data[\"TUACTIVITY_N\"].toString();\n        processed_data[data[\"TUCASEID\"]][\"activity\"][activity_id] = {\n          \"start\": data[\"start_minute\"],\n          \"stop\": data[\"stop_minute\"],\n          \"activity_code\": data[\"TUTIER1CODE\"]\n        };\n      });\n      var activity_codes = {\n        \"1\": \" ROI 1\",\n        \"2\": \" ROI 2\",\n        \"3\": \"ROI 3\",\n        \"4\": \"ROI 4\",\n        \"5\": \"ROI 5\",\n        \"6\": \"ROI 6\",\n        \"7\": \"ROI 7\",\n        \"8\": \"ROI 8\",\n        \"9\": \"ROI 9\",\n        \"10\": \"ROI 10\",\n        \"11\": \"ROI 11\",\n        \"12\": \"ROI 12\",\n        \"13\": \"ROI 13\",\n        \"14\": \"ROI 14\",\n        \"15\": \"ROI 15\",\n        \"16\": \"ROI 16\",\n        \"17\": \"ROI 17\",\n        \"18\": \"ROI 18\",\n        \"19\": \"ROI 19\",\n        \"20\": \"ROI 20\",\n        \"21\": \"ROI 21\",\n        \"22\": \"ROI 22\"\n      };\n      var radians = 0.0174532925;\n      var vizRadius = 350;\n      var margin = 100;\n      var width = (vizRadius + margin) * 2;\n      var height = (vizRadius + margin) * 2;\n      var activityCodes = activity_codes;\n      var activityDictionary = activity_codes;\n      var numCategories = activityCodes.length;\n      var codesScale = d3.scaleLinear().range([0, 360]).domain([0, numCategories - 1]);\n      var fociGroups = {};\n\n      for (var i = 0; i < numCategories; i++) {\n        fociGroups[activityCodes[i]] = {};\n\n        if (i == 0) {\n          fociGroups[activityCodes[i]]['x'] = 0;\n          fociGroups[activityCodes[i]]['y'] = 0;\n        } else {\n          fociGroups[activityCodes[i]]['x'] = (vizRadius - 80) * Math.sin(codesScale(i - 1) * radians);\n          fociGroups[activityCodes[i]]['y'] = -(vizRadius - 80) * Math.cos(codesScale(i - 1) * radians);\n        }\n      }\n\n      var svg = d3.select(\"#\" + \"Chart\").append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n      var vizGroup = svg.append(\"g\").attr(\"id\", \"viz-area\").attr(\"transform\", \"translate(\".concat(vizRadius + margin, \",\").concat(vizRadius + margin, \")\"));\n      vizGroup.selectAll('.second-label').data(activityCodes).enter().append('text').attr('class', \"second-label\").attr('text-anchor', 'middle').attr('x', function (d, i) {\n        if (i == 0) {\n          return 0;\n        }\n\n        return vizRadius * Math.sin(codesScale(i - 1) * radians);\n      }).attr('y', function (d, i) {\n        if (i == 0) {\n          return 0;\n        }\n\n        return -vizRadius * Math.cos(codesScale(i - 1) * radians);\n      }).attr('z', 100).html(function (d, i) {\n        if (i == 0) {\n          return \"<tspan x=\\\"0\\\" y=\\\"0\\\"  z=\\\"100\\\">\".concat(activityDictionary[d], \"</tspan>\\n                            <tspan class=\\\"\").concat(\"perc\" + activityCodes[i], \"\\\" x=\\\"0\\\" y=\\\"0\\\", dy=\\\"1.5em\\\" \\\">\").concat(i, \"%</tspan>\");\n        }\n\n        return \"<tspan x=\\\"\".concat(vizRadius * Math.sin(codesScale(i - 1) * radians), \"\\\" y=\\\"\").concat(-vizRadius * Math.cos(codesScale(i - 1) * radians), \"\\\"  z=\\\"100\\\">\").concat(activityDictionary[d], \"</tspan>\\n                            <tspan class=\\\"\").concat(\"perc\" + activityCodes[i], \"\\\" x=\\\"\").concat(vizRadius * Math.sin(codesScale(i - 1) * radians), \"\\\" y=\\\"\").concat(-vizRadius * Math.cos(codesScale(i - 1) * radians), \"\\\" dy=1em  z=\\\"100\\\" >\").concat(i, \"%</tspan>\");\n      }); // for(i=0;i<numCategories;i++){\n      //     vizGroup.append('circle').\n      //         attr('cx',fociGroups[activityCodes[i]]['x']).\n      //         attr('cy',fociGroups[activityCodes[i]]['y']).\n      //         attr('r',10)\n      // }\n      // force animation code\n\n      function color(id) {\n        if (id == 50) {\n          id = 19;\n        }\n\n        var val = id / 19;\n        return d3.interpolateRainbow(val);\n      }\n\n      var node = vizGroup.selectAll(\".people\").data(processed_data_arr, function (d) {\n        return d.key;\n      }).enter().append(\"circle\").attr(\"r\", 3).attr(\"fill\", function (d) {\n        return color(+d['activity'][d.current_activity].activity_code);\n      });\n      var forceX = d3.forceX(function (d) {\n        return fociGroups[d['activity'][d.current_activity].activity_code].x;\n      }); //fociGroups[d['activity'][d.current_activity].activity_code].x);\n\n      var forceY = d3.forceY(function (d) {\n        return fociGroups[d['activity'][d.current_activity].activity_code].y;\n      });\n      var force = d3.forceSimulation(processed_data_arr).velocityDecay(0.65).force('x', forceX).force('y', forceY).force(\"collide\", d3.forceCollide(3));\n      force.nodes(processed_data_arr).on('tick', function () {\n        node.attr('transform', function (d) {\n          return 'translate(' + d.x + ',' + d.y + ')';\n        });\n      });\n\n      function pad(d) {\n        return d < 10 ? '0' + d.toString() : d.toString();\n      }\n\n      d3.interval(function () {\n        time = (time + 1) % 60;\n        hour = Math.floor(time / 60);\n        minutes = time - hour * 60;\n\n        if (hour > 12 && hour < 24) {\n          hour = hour - 12;\n          d3.select(\"#time\").text(pad(hour) + \":\" + pad(minutes) + \" a.m.\");\n        } else {\n          hour = hour % 24;\n          d3.select(\"#time\").text(pad(hour) + \":\" + pad(minutes) + \" p.m.\");\n        }\n\n        var percentage_counts = {};\n        processed_data_arr.forEach(function (d) {\n          if (time == 20) {\n            d.current_activity = 1;\n          } else if (d.current_activity == 0) {//le\n          } else if (+d['activity'][d.current_activity][\"stop\"] < time) {\n            d.current_activity = (d.current_activity + 1) % d.activity.length;\n\n            if (d.current_activity == 0) {\n              console.log(1);\n            }\n          } //count percentage of each activity\n\n\n          if (percentage_counts[d['activity'][d.current_activity].activity_code] == undefined) {\n            percentage_counts[d['activity'][d.current_activity].activity_code] = 1;\n          } else {\n            percentage_counts[d['activity'][d.current_activity].activity_code] += 1;\n          }\n        });\n\n        for (var i = 0; i < activityCodes.length; i++) {\n          var val = percentage_counts[activityCodes[i]];\n\n          if (val == undefined) {\n            val = 0;\n          }\n\n          val = val / 10;\n          val = Math.floor(val * 100) / 100;\n          d3.select(\".perc\" + activityCodes[i]).text(val + \"%\");\n        }\n\n        node.transition().duration(0).attr(\"fill\", function (d) {\n          return color(d['activity'][d.current_activity].activity_code);\n        });\n        force.nodes(processed_data_arr);\n        force.alpha(0.8).restart();\n      }, 100);\n      vizGroup.selectAll('.second-label').raise();\n    };\n\n    return _this;\n  }\n\n  _createClass(Tables, [{\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(Container, {\n        fluid: true,\n        className: \"main-content-container px-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        noGutters: true,\n        className: \"page-header py-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"title\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 9\n        }\n      }, \"USA demo\"), /*#__PURE__*/React.createElement(\"link\", {\n        href: \"https://fonts.googleapis.com/css?family=Orbitron\",\n        rel: \"stylesheet\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"link\", {\n        href: \"https://fonts.googleapis.com/css?family=Unlock\",\n        rel: \"stylesheet\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        id: \"title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 9\n        }\n      }, \"The American way of life\"), /*#__PURE__*/React.createElement(\"script\", {\n        src: \"https://d3js.org/d3.v5.min.js\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"script\", {\n        type: \"text/javascript\",\n        src: \"http://localhost/html/main/usa_data.js\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 9\n        }\n      })));\n    }\n  }]);\n\n  return Tables;\n}(React.Component);\n\nexport default Tables;","map":{"version":3,"sources":["C:/viz/visualyticsFrontend/src/views/Tables.js"],"names":["React","Container","Row","Col","Card","CardHeader","CardBody","d3","Tables","create_visualization","processed_data_arr","keys","Object","processed_data","i","length","dat","push","time","csv","data","undefined","activity_id","toString","activity_codes","radians","vizRadius","margin","width","height","activityCodes","activityDictionary","numCategories","codesScale","scaleLinear","range","domain","fociGroups","Math","sin","cos","svg","select","append","attr","vizGroup","selectAll","enter","d","html","color","id","val","interpolateRainbow","node","key","current_activity","activity_code","forceX","x","forceY","y","force","forceSimulation","velocityDecay","forceCollide","nodes","on","pad","interval","hour","floor","minutes","text","percentage_counts","forEach","activity","console","log","transition","duration","alpha","restart","raise","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Container, Row, Col, Card, CardHeader, CardBody } from \"shards-react\";\r\n// import ScriptTag from 'react-script-tag';\r\nimport * as d3 from \"d3\";\r\n\r\n\r\nclass Tables extends React.Component {\r\n  // componentDidMount() {}\r\n    \r\n      create_visualization = () => {\r\n\r\n        var processed_data_arr = [];\r\n      \r\n      var keys = Object.keys(processed_data)\r\n      for(var i=0;i<keys.length;i++){\r\n        var dat = processed_data[keys[i]]\r\n          dat[\"key\"] = keys[i]\r\n          processed_data_arr.push(dat)\r\n      }\r\n\r\n      var time = 1\r\n\r\n      var processed_data = {}\r\n\r\n      d3.csv('http://localhost/html/main/journey.csv', function(data) {\r\n          if(processed_data[data[\"TUCASEID\"]] === undefined){\r\n              processed_data[data[\"TUCASEID\"]] = {}\r\n              processed_data[data[\"TUCASEID\"]][\"activity\"] = [{\r\n                                                                          \"start\": 20,\r\n                                                                          \"stop\": 20,\r\n                                                                          \"activity_code\": 0\r\n                                                                      }]\r\n              processed_data[data[\"TUCASEID\"]][\"current_activity\"] = 1\r\n          }\r\n          var activity_id = data[\"TUACTIVITY_N\"].toString()\r\n          processed_data[data[\"TUCASEID\"]][\"activity\"][activity_id] = {\r\n                                                                          \"start\": data[\"start_minute\"],\r\n                                                                          \"stop\": data[\"stop_minute\"],\r\n                                                                          \"activity_code\": data[\"TUTIER1CODE\"]\r\n                                                                      }\r\n\r\n\r\n      })\r\n\r\n        let activity_codes = {\r\n          \"1\":\" ROI 1\",\r\n          \"2\":\" ROI 2\",\r\n          \"3\": \"ROI 3\",\r\n          \"4\": \"ROI 4\",\r\n          \"5\": \"ROI 5\",\r\n          \"6\": \"ROI 6\",\r\n          \"7\": \"ROI 7\",\r\n          \"8\": \"ROI 8\",\r\n          \"9\": \"ROI 9\",\r\n          \"10\" : \"ROI 10\",\r\n          \"11\": \"ROI 11\",\r\n          \"12\": \"ROI 12\",\r\n          \"13\": \"ROI 13\",\r\n          \"14\": \"ROI 14\",\r\n          \"15\": \"ROI 15\",\r\n          \"16\": \"ROI 16\",\r\n          \"17\": \"ROI 17\",\r\n          \"18\": \"ROI 18\",\r\n          \"19\": \"ROI 19\",\r\n          \"20\": \"ROI 20\",\r\n          \"21\": \"ROI 21\",\r\n          \"22\": \"ROI 22\"\r\n          };\r\n\r\n        var radians = 0.0174532925;\r\n        var vizRadius = 350;\r\n        var margin = 100;\r\n        var width = (vizRadius+margin)*2 ;\r\n        var height = (vizRadius+margin)*2;\r\n    \r\n        var activityCodes = activity_codes;\r\n        var activityDictionary = activity_codes;\r\n        var numCategories = activityCodes.length;\r\n    \r\n    \r\n        var codesScale = d3.scaleLinear()\r\n        .range([0,360])\r\n        .domain([0,numCategories-1]);\r\n    \r\n        var fociGroups = {}\r\n        for(var i=0;i<numCategories;i++){\r\n            fociGroups[activityCodes[i]]={}\r\n            if(i==0){\r\n               fociGroups[activityCodes[i]]['x']=0\r\n               fociGroups[activityCodes[i]]['y']=0\r\n            }\r\n            else{\r\n                fociGroups[activityCodes[i]]['x']= (vizRadius-80)*Math.sin(codesScale(i-1)*radians);\r\n                fociGroups[activityCodes[i]]['y']= -(vizRadius-80)*Math.cos(codesScale(i-1)*radians);\r\n            }\r\n        }\r\n    \r\n        var svg = d3.select(\"#\"+\"Chart\").\r\n        append(\"svg\").\r\n        attr(\"width\",width).\r\n        attr(\"height\",height)\r\n        var vizGroup = svg.append(\"g\").\r\n                    attr(\"id\",\"viz-area\").\r\n                    attr(\"transform\",`translate(${vizRadius+margin},${vizRadius+margin})`)\r\n    \r\n    \r\n        vizGroup.selectAll('.second-label')\r\n            .data(activityCodes)\r\n                .enter()\r\n                .append('text')\r\n                .attr('class',\"second-label\")\r\n                .attr('text-anchor','middle')\r\n                .attr('x',function(d,i){\r\n                    if(i==0){\r\n                        return 0;\r\n                    }\r\n                    return vizRadius*Math.sin(codesScale(i-1)*radians);\r\n                })\r\n                .attr('y',function(d,i){\r\n                    if(i==0){\r\n                        return 0;\r\n                    }\r\n                    return -vizRadius*Math.cos(codesScale(i-1)*radians) ;\r\n                })\r\n                .attr('z',100)\r\n                .html(function(d,i){\r\n                     if(i==0){\r\n                        return `<tspan x=\"0\" y=\"0\"  z=\"100\">${activityDictionary[d]}</tspan>\r\n                            <tspan class=\"${\"perc\"+activityCodes[i]}\" x=\"0\" y=\"0\", dy=\"1.5em\" \">${i}%</tspan>`;\r\n                    }\r\n                    return `<tspan x=\"${vizRadius*Math.sin(codesScale(i-1)*radians)}\" y=\"${-vizRadius*Math.cos(codesScale(i-1)*radians)}\"  z=\"100\">${activityDictionary[d]}</tspan>\r\n                            <tspan class=\"${\"perc\"+activityCodes[i]}\" x=\"${vizRadius*Math.sin(codesScale(i-1)*radians)}\" y=\"${-vizRadius*Math.cos(codesScale(i-1)*radians)}\" dy=1em  z=\"100\" >${i}%</tspan>`;\r\n                });\r\n    \r\n        // for(i=0;i<numCategories;i++){\r\n        //     vizGroup.append('circle').\r\n        //         attr('cx',fociGroups[activityCodes[i]]['x']).\r\n        //         attr('cy',fociGroups[activityCodes[i]]['y']).\r\n        //         attr('r',10)\r\n    \r\n        // }\r\n    \r\n    \r\n        // force animation code\r\n    \r\n    \r\n    \r\n        function color(id){\r\n            if(id==50){\r\n                id=19\r\n            }\r\n            var val = id/19\r\n            return d3.interpolateRainbow(val);\r\n    \r\n        }\r\n    \r\n        var node = vizGroup\r\n                .selectAll(\".people\")\r\n                .data(processed_data_arr,d => d.key)\r\n                .enter().append(\"circle\")\r\n                .attr(\"r\", 3)\r\n                .attr(\"fill\", (d)=>color(+d['activity'][d.current_activity].activity_code));\r\n    \r\n        var forceX = d3.forceX((d) => fociGroups[d['activity'][d.current_activity].activity_code].x);//fociGroups[d['activity'][d.current_activity].activity_code].x);\r\n        var forceY = d3.forceY((d) => fociGroups[d['activity'][d.current_activity].activity_code].y);\r\n    \r\n        var force = d3.forceSimulation(processed_data_arr)\r\n        .velocityDecay(0.65)\r\n        .force('x', forceX)\r\n        .force('y', forceY)\r\n        .force(\"collide\", d3.forceCollide(3));\r\n    \r\n        force.nodes(processed_data_arr)\r\n        .on('tick', function() {\r\n             node\r\n                .attr('transform', (d) => {\r\n                    return 'translate(' + (d.x) + ',' + (d.y) + ')';\r\n                });\r\n            });\r\n    \r\n        function pad(d) {\r\n            return (d < 10) ? '0' + d.toString() : d.toString();\r\n        }\r\n    \r\n        d3.interval(function(){\r\n            time = (time+1)% 60\r\n            hour = Math.floor(time/60)\r\n    \r\n            minutes = time - hour*60\r\n            if(hour>12 && hour < 24){\r\n                hour = hour-12\r\n                d3.select(\"#time\").text(pad(hour)+\":\"+pad(minutes)+\" a.m.\" )\r\n            }\r\n            else{\r\n                hour = hour%24\r\n                d3.select(\"#time\").text(pad(hour)+\":\"+pad(minutes)+\" p.m.\" )\r\n    \r\n            }\r\n    \r\n            var percentage_counts = {};\r\n            processed_data_arr.forEach(function(d){\r\n                if(time == 20){\r\n                    d.current_activity=1\r\n                }\r\n                else if(d.current_activity==0){\r\n                        //le\r\n                }\r\n                else if(+d['activity'][d.current_activity][\"stop\"] < time){\r\n                    d.current_activity = (d.current_activity+ 1)% d.activity.length\r\n                    if(d.current_activity==0){\r\n                        console.log(1)\r\n                    }\r\n                }\r\n    \r\n                //count percentage of each activity\r\n                if( percentage_counts[d['activity'][d.current_activity].activity_code] == undefined){\r\n                    percentage_counts[d['activity'][d.current_activity].activity_code]=1\r\n                }\r\n                else{\r\n                    percentage_counts[d['activity'][d.current_activity].activity_code] += 1\r\n                }\r\n    \r\n            })\r\n            for(var i =0;i<activityCodes.length;i++){\r\n              var val = percentage_counts[activityCodes[i]]\r\n                    if(val == undefined){\r\n                        val =0\r\n                    }\r\n                    val = val/10\r\n                    val = Math.floor(val*100)/100\r\n                    d3.select(\".perc\"+activityCodes[i]).text(val+\"%\")\r\n            }\r\n            node.transition().duration(0).attr(\"fill\", (d)=>color(d['activity'][d.current_activity].activity_code));\r\n            force.nodes(processed_data_arr);\r\n            force.alpha(0.8).restart();\r\n        },100)\r\n    \r\n    \r\n        vizGroup.selectAll('.second-label').raise()\r\n    }\r\n\r\n   \r\n\r\n\r\n  \r\n  render(){\r\n    return(\r\n      \r\n      <Container fluid className=\"main-content-container px-4\">\r\n        <Row noGutters className=\"page-header py-4\">\r\n        <title>USA demo</title>\r\n        <link href=\"https://fonts.googleapis.com/css?family=Orbitron\" rel=\"stylesheet\"></link>\r\n        <link href=\"https://fonts.googleapis.com/css?family=Unlock\" rel=\"stylesheet\"></link>\r\n        {/* <link rel=\"stylesheet\" type=\"text/css\" href=\"http://localhost/html/main/usa_data.css\"></link> */}\r\n        <div id=\"title\">The American way of life</div>\r\n        <script src=\"https://d3js.org/d3.v5.min.js\"></script>\r\n        <script type=\"text/javascript\" src=\"http://localhost/html/main/usa_data.js\"></script>\r\n        {/* <img src=\"http://localhost/html/main/a.png\" width=\"500\" alt=\"ROI Locations\" /> */}\r\n        </Row>\r\n        </Container>\r\n    );\r\n  }\r\n} \r\n\r\nexport default Tables;"]},"metadata":{},"sourceType":"module"}